# é»æ•¸è¦å‰‡åŠŸèƒ½æª¢æŸ¥æ¸…å–®

## âœ… å·²å¯¦ç¾çš„åŠŸèƒ½

### 1. å‰ç«¯ - å°èˆªå’Œç•Œé¢
- âœ… **é»æ•¸è¦å‰‡æ¨™ç±¤**ï¼šå·²æ·»åŠ åˆ°æœƒå“¡åˆ¶åº¦ç®¡ç†é é¢
- âœ… **é è¨­æ¨™ç±¤**ï¼šé€²å…¥é é¢æ™‚é è¨­é¡¯ç¤ºã€Œé»æ•¸è¦å‰‡ã€
- âœ… **å°èˆªæŒ‰éˆ•**ï¼šé»æ•¸è¦å‰‡ | æœƒå“¡ç­‰ç´š | å…Œæ›å•†å“

### 2. å‰ç«¯ - é»æ•¸è¦å‰‡åˆ—è¡¨
- âœ… **ç©ºç‹€æ…‹é¡¯ç¤º**ï¼šç•¶æ²’æœ‰è¦å‰‡æ™‚é¡¯ç¤ºæç¤º
- âœ… **è¦å‰‡åˆ—è¡¨è¡¨æ ¼**ï¼š
  - è¦å‰‡åç¨±
  - é»æ•¸ç´¯ç©æ–¹å¼ï¼ˆé¡¯ç¤ºç‚ºã€Œæ¯æ¶ˆè²» $X å…ƒç´¯ç© 1 é»ã€ï¼‰
  - æœ€ä½æ¶ˆè²»é‡‘é¡
  - åˆªé™¤æŒ‰éˆ•
- âœ… **æ•¸æ“šä¾†æº**ï¼šå¾å¾Œç«¯ API è¼‰å…¥ (`/loyalty/merchant/point-rules/`)

### 3. å‰ç«¯ - æ–°å¢è¦å‰‡è¡¨å–®
- âœ… **è¡¨å–®æ¬„ä½**ï¼š
  - è¦å‰‡åç¨±ï¼ˆå¿…å¡«ï¼‰
  - **æ¯æ¶ˆè²»å¤šå°‘å…ƒå¯ä»¥ç´¯ç© 1 é»**ï¼ˆç›´è§€è¼¸å…¥ï¼Œä¾‹å¦‚ï¼š100ï¼‰
  - æœ€ä½æ¶ˆè²»é‡‘é¡ï¼ˆå¯é¸ï¼‰
- âœ… **æç¤ºèªªæ˜**ï¼šæ¸…æ¥šçš„ä½¿ç”¨èªªæ˜
- âœ… **é©—è­‰**ï¼šæª¢æŸ¥å¿…å¡«æ¬„ä½
- âœ… **æäº¤**ï¼šé€é API æ–°å¢è¦å‰‡
- âœ… **æˆåŠŸæç¤º**ï¼šæ–°å¢æˆåŠŸå¾Œé¡¯ç¤ºæç¤ºä¸¦é‡æ–°è¼‰å…¥åˆ—è¡¨

### 4. å‰ç«¯ - åˆªé™¤è¦å‰‡
- âœ… **ç¢ºèªå°è©±æ¡†**ï¼šåˆªé™¤å‰è¦æ±‚ç¢ºèª
- âœ… **API å‘¼å«**ï¼šé€é DELETE è«‹æ±‚åˆªé™¤
- âœ… **æˆåŠŸæç¤º**ï¼šåˆªé™¤æˆåŠŸå¾Œé¡¯ç¤ºæç¤ºä¸¦é‡æ–°è¼‰å…¥åˆ—è¡¨

### 5. å¾Œç«¯ - é»æ•¸è¦å‰‡ API
- âœ… **GET** `/loyalty/merchant/point-rules/`ï¼šæŸ¥çœ‹è¦å‰‡åˆ—è¡¨
- âœ… **POST** `/loyalty/merchant/point-rules/`ï¼šæ–°å¢è¦å‰‡
- âœ… **DELETE** `/loyalty/merchant/point-rules/{id}/`ï¼šåˆªé™¤è¦å‰‡
- âœ… **æ¬Šé™æ§åˆ¶**ï¼šåªæœ‰å•†å®¶å¯ä»¥ç®¡ç†è‡ªå·±çš„è¦å‰‡

### 6. å¾Œç«¯ - è‡ªå‹•é»æ•¸è¨ˆç®—
- âœ… **å¤–å¸¶è¨‚å–®**ï¼šè¨‚å–®å»ºç«‹æ™‚è‡ªå‹•è¨ˆç®—é»æ•¸
- âœ… **å…§ç”¨è¨‚å–®**ï¼šè¨‚å–®å»ºç«‹æ™‚è‡ªå‹•è¨ˆç®—é»æ•¸
- âœ… **è¨ˆç®—é‚è¼¯**ï¼š
  ```
  ç²å¾—é»æ•¸ = floor(è¨‚å–®é‡‘é¡ Ã— points_per_currency)
  ```
- âœ… **æ¢ä»¶æª¢æŸ¥**ï¼š
  - ç”¨æˆ¶å·²ç™»å…¥
  - åº—å®¶å•Ÿç”¨æœƒå“¡åŠŸèƒ½
  - æœ‰æ´»èºçš„é»æ•¸è¦å‰‡
  - è¨‚å–®é‡‘é¡é”åˆ°æœ€ä½é–€æª»
- âœ… **æ›´æ–°å¸³æˆ¶**ï¼šè‡ªå‹•æ›´æ–° available_points å’Œ total_points
- âœ… **äº¤æ˜“è¨˜éŒ„**ï¼šå‰µå»º PointTransaction è¨˜éŒ„

### 7. é¡§å®¢ç«¯ - é»æ•¸é¡¯ç¤º
- âœ… **æœƒå“¡ä¸­å¿ƒ**ï¼šé¡¯ç¤ºæ‰€æœ‰åº—å®¶çš„æœƒå“¡è³‡è¨Š
- âœ… **é»æ•¸é¡¯ç¤º**ï¼š
  - å¯ç”¨é»æ•¸ï¼ˆå¤§æ•¸å­—ï¼‰
  - ç´¯è¨ˆé»æ•¸ï¼ˆå°å­—ï¼‰
- âœ… **åº—å®¶ç‰¹å®šæœƒå“¡ä¸­å¿ƒ**ï¼šå¾åº—å®¶é é¢é€²å…¥æŸ¥çœ‹è©²åº—é»æ•¸
- âœ… **é›™æ¨¡å¼è·¯ç”±**ï¼š
  - `/customer/loyalty` - æ‰€æœ‰åº—å®¶
  - `/customer/loyalty/:storeId` - ç‰¹å®šåº—å®¶

## ğŸ§ª æ¸¬è©¦æ­¥é©Ÿ

### æ¸¬è©¦ 1ï¼šæŸ¥çœ‹é»æ•¸è¦å‰‡
1. âœ… è¨ªå• http://localhost:3001/login
2. âœ… ç™»å…¥å•†å®¶å¸³è™Ÿï¼šwhisper@gmail.com
3. âœ… é€²å…¥ã€Œæœƒå“¡åˆ¶åº¦ç®¡ç†ã€
4. âœ… ç¢ºèªé è¨­é¡¯ç¤ºã€Œé»æ•¸è¦å‰‡ã€æ¨™ç±¤
5. âœ… ç¢ºèªçœ‹åˆ°å·²å‰µå»ºçš„ã€ŒåŸºæœ¬é»æ•¸è¦å‰‡ã€
   - é¡¯ç¤ºï¼šæ¯æ¶ˆè²» $100 å…ƒç´¯ç© 1 é»

### æ¸¬è©¦ 2ï¼šæ–°å¢é»æ•¸è¦å‰‡
1. âœ… é»æ“Šã€Œæ–°å¢è¦å‰‡ã€æŒ‰éˆ•
2. âœ… å¡«å¯«è¡¨å–®ï¼š
   - è¦å‰‡åç¨±ï¼šé€±æœ«å„ªæƒ 
   - æ¯æ¶ˆè²»å¤šå°‘å…ƒå¯ä»¥ç´¯ç© 1 é»ï¼š50
   - æœ€ä½æ¶ˆè²»é‡‘é¡ï¼š100
3. âœ… é»æ“Šã€Œç¢ºèªæ–°å¢ã€
4. âœ… ç¢ºèªé¡¯ç¤ºæˆåŠŸæç¤º
5. âœ… ç¢ºèªåˆ—è¡¨ä¸­å‡ºç¾æ–°è¦å‰‡

### æ¸¬è©¦ 3ï¼šåˆªé™¤é»æ•¸è¦å‰‡
1. âœ… åœ¨è¦å‰‡åˆ—è¡¨ä¸­é»æ“Šã€Œåˆªé™¤ã€æŒ‰éˆ•
2. âœ… ç¢ºèªå‡ºç¾ç¢ºèªå°è©±æ¡†
3. âœ… é»æ“Šã€Œç¢ºå®šã€
4. âœ… ç¢ºèªé¡¯ç¤ºæˆåŠŸæç¤º
5. âœ… ç¢ºèªè¦å‰‡å¾åˆ—è¡¨ä¸­æ¶ˆå¤±

### æ¸¬è©¦ 4ï¼šé¡§å®¢ç²å¾—é»æ•¸
1. âœ… ç™»å‡ºå•†å®¶å¸³è™Ÿ
2. âœ… ç™»å…¥é¡§å®¢å¸³è™Ÿ
3. âœ… è¨ªå•æ«»èŠ±æ—¥å¼æ–™ç†åº—å®¶
4. âœ… ä¸‹å–®ï¼ˆç¸½é‡‘é¡ > 100 å…ƒï¼‰
5. âœ… å®Œæˆè¨‚å–®

### æ¸¬è©¦ 5ï¼šæŸ¥çœ‹ç²å¾—çš„é»æ•¸
1. âœ… åœ¨åº—å®¶é é¢é»æ“Šã€Œæœƒå“¡ä¸­å¿ƒã€
2. âœ… ç¢ºèªé¡¯ç¤ºè©²åº—å®¶çš„æœƒå“¡è³‡è¨Š
3. âœ… ç¢ºèªã€Œå¯ç”¨é»æ•¸ã€æ­£ç¢ºé¡¯ç¤º
4. âœ… ç¢ºèªã€Œç´¯è¨ˆé»æ•¸ã€æ­£ç¢ºé¡¯ç¤º

## ğŸ“Š æ•¸æ“šé©—è­‰

### ä½¿ç”¨ Django Shell é©—è­‰

```bash
cd backend
.\.venv\Scripts\python.exe manage.py shell
```

```python
# æª¢æŸ¥é»æ•¸è¦å‰‡
from apps.loyalty.models import PointRule
from apps.stores.models import Store

store = Store.objects.get(name='æ«»èŠ±æ—¥å¼æ–™ç†')
rules = PointRule.objects.filter(store=store, active=True)
for rule in rules:
    currency_per_point = 1 / rule.points_per_currency if rule.points_per_currency > 0 else 0
    print(f"{rule.name}: æ¯æ¶ˆè²» {currency_per_point:.0f} å…ƒå¾— 1 é»")

# æª¢æŸ¥æœƒå“¡å¸³æˆ¶å’Œé»æ•¸
from apps.loyalty.models import CustomerLoyaltyAccount

accounts = CustomerLoyaltyAccount.objects.filter(store=store)
for account in accounts:
    print(f"{account.user.email}: å¯ç”¨ {account.available_points} é» | ç´¯è¨ˆ {account.total_points} é»")

# æª¢æŸ¥é»æ•¸äº¤æ˜“è¨˜éŒ„
from apps.loyalty.models import PointTransaction

for account in accounts:
    transactions = PointTransaction.objects.filter(account=account).order_by('-created_at')[:5]
    print(f"\n{account.user.email} çš„æœ€è¿‘äº¤æ˜“ï¼š")
    for t in transactions:
        print(f"  {t.created_at.strftime('%Y-%m-%d %H:%M')}: {t.points:+d} é» - {t.description}")
```

## ğŸ¯ é æœŸçµæœ

### å•†å®¶ç«¯
- âœ… å¯ä»¥çœ‹åˆ°ã€Œé»æ•¸è¦å‰‡ã€æ¨™ç±¤
- âœ… å¯ä»¥æ–°å¢è¦å‰‡ï¼Œè¼¸å…¥æ–¹å¼ç›´è§€ï¼ˆæ¯Xå…ƒå¾—1é»ï¼‰
- âœ… è¦å‰‡åˆ—è¡¨æ¸…æ¥šé¡¯ç¤ºç´¯ç©æ–¹å¼
- âœ… å¯ä»¥åˆªé™¤è¦å‰‡

### ç³»çµ±å¾Œç«¯
- âœ… è¨‚å–®å®Œæˆæ™‚è‡ªå‹•è¨ˆç®—é»æ•¸
- âœ… é»æ•¸è¨ˆç®—æº–ç¢ºï¼ˆè¨‚å–®é‡‘é¡ Ã· æ¯é»æ‰€éœ€é‡‘é¡ï¼‰
- âœ… æœƒå“¡å¸³æˆ¶é»æ•¸æ­£ç¢ºæ›´æ–°
- âœ… å‰µå»ºé»æ•¸äº¤æ˜“è¨˜éŒ„

### é¡§å®¢ç«¯
- âœ… æœƒå“¡ä¸­å¿ƒé¡¯ç¤ºé»æ•¸
- âœ… å¯ç”¨é»æ•¸å’Œç´¯è¨ˆé»æ•¸éƒ½æ­£ç¢º
- âœ… é»æ•¸å³æ™‚æ›´æ–°

## ğŸ” æ•…éšœæ’é™¤

å¦‚æœåŠŸèƒ½æ²’æœ‰é¡¯ç¤ºï¼š

1. **æª¢æŸ¥ç€è¦½å™¨**ï¼šæ¸…é™¤å¿«å–ä¸¦é‡æ–°è¼‰å…¥ï¼ˆCtrl + Shift + Rï¼‰
2. **æª¢æŸ¥çµ‚ç«¯**ï¼šç¢ºèªæ²’æœ‰ç·¨è­¯éŒ¯èª¤
3. **æª¢æŸ¥é–‹ç™¼è€…å·¥å…·**ï¼šF12 æŸ¥çœ‹ Console å’Œ Network æ¨™ç±¤
4. **æª¢æŸ¥æœå‹™**ï¼š
   - å¾Œç«¯ï¼šhttp://127.0.0.1:8000/
   - å‰ç«¯ï¼šhttp://localhost:3001/
